<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Сообщения</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  font-family:system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

#app{
  width:100%;
  max-width:420px;
  height:100%;
  background:#111;
  display:flex;
  flex-direction:column;
  box-shadow:0 0 40px rgba(0,0,0,.8);
}

/* ===== HEADER ===== */
#header{
  padding:14px;
  background:#1a1a1a;
  color:#e5e5e5;
  font-weight:600;
  text-align:center;
  border-bottom:1px solid #222;
}

/* ===== CHAT ===== */
#chat{
  flex:1;
  padding:12px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* ===== MESSAGES ===== */
.msg{
  max-width:80%;
  padding:10px 12px;
  border-radius:12px;
  font-size:15px;
  line-height:1.4;
  animation:fadeIn .3s ease;
}

.system{
  background:#2a2a2a;
  color:#ccc;
  align-self:center;
  font-size:13px;
  opacity:.8;
}

.other{
  background:#1f1f2f;
  color:#e5e5ff;
  align-self:flex-start;
}

.you{
  background:#3a3a3a;
  color:#fff;
  align-self:flex-end;
}

/* ===== CHOICES ===== */
#choices{
  padding:10px;
  border-top:1px solid #222;
  background:#141414;
}

.choice{
  width:100%;
  padding:10px;
  margin-top:8px;
  background:#1e1e1e;
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:15px;
}

/* ===== EFFECTS ===== */
@keyframes fadeIn{
  from{opacity:0;transform:translateY(4px)}
  to{opacity:1;transform:none}
}

.glitch{
  animation:glitch .2s infinite;
}
@keyframes glitch{
  0%{text-shadow:2px 0 red}
  50%{text-shadow:-2px 0 cyan}
  100%{text-shadow:none}
}

.shake{
  animation:shake .4s infinite;
}
@keyframes shake{
  0%{transform:translate(0,0)}
  25%{transform:translate(-2px,1px)}
  50%{transform:translate(2px,-1px)}
  75%{transform:translate(-1px,2px)}
  100%{transform:translate(0,0)}
}
</style>
</head>
<body>

<div id="app">
  <div id="header">Сообщения</div>
  <div id="chat"></div>
  <div id="choices"></div>
</div>

<audio id="click" src="click.mp3"></audio>
<audio id="bgm" src="music.mp3" loop></audio>

<script>
const chat=document.getElementById("chat");
const choices=document.getElementById("choices");
const header=document.getElementById("header");
const click=document.getElementById("click");
const bgm=document.getElementById("bgm");

let musicStarted=false;

function playClick(){
  click.currentTime=0;
  click.play();
  if(!musicStarted){
    bgm.volume=.4;
    bgm.play();
    musicStarted=true;
  }
}

function addMsg(text,type="other"){
  const div=document.createElement("div");
  div.className="msg "+type;
  div.textContent=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

function clearChoices(){
  choices.innerHTML="";
}

function addChoice(text,action){
  const b=document.createElement("button");
  b.className="choice";
  b.textContent=text;
  b.onclick=()=>{
    playClick();
    clearChoices();
    addMsg(text,"you");
    action();
  };
  choices.appendChild(b);
}

/* ===== STORY ===== */

function start(){
  header.textContent="Сообщения";
  chat.innerHTML="";
  addMsg("Подключение…","system");

  setTimeout(()=>{
    addMsg("Ты не должен был отвечать.","other");
    addChoice("Кто это?",q1);
    addChoice("…",q1);
  },800);
}

function q1(){
  addMsg("Ты здесь.","other");
  addMsg("03:17","system");
  addChoice("Где я?",q2);
}

function q2(){
  addMsg("Ты всегда был здесь.","other");
  header.classList.add("glitch");
  addChoice("Хватит",q3);
}

function q3(){
  header.textContent="Неизвестный";
  header.classList.remove("glitch");
  document.getElementById("app").classList.add("shake");

  addMsg("Дверь можно открыть один раз.","other");
  addChoice("Открыть дверь",chapter2);
}

function chapter2(){
  document.getElementById("app").classList.remove("shake");
  header.textContent="Сообщения";

  addMsg("Соединение восстановлено","system");
  addMsg("Ты больше не можешь говорить.","system");
  addMsg("Но можешь читать.","other");

  addChoice("Кто ты?",chapter3);
}

function chapter3(){
  header.textContent="Ты";
  addMsg("Мы — те, кто остался без чата.","other");
  addMsg("Ты займёшь чьё-то место?","other");

  addChoice("Да",badEnding);
  addChoice("Нет",goodEnding);
}

function goodEnding(){
  addMsg("Сеанс завершён.","system");
  addMsg("Ты вышел.","system");
  addChoice("Начать заново",start);
}

function badEnding(){
  document.getElementById("app").classList.add("shake");
  addMsg("Теперь ты — часть нас.","other");
  addMsg("Чат не закрывается.","system");
  addChoice("Начать заново",start);
}

start();
</script>
</body>
</html>
