<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LINEA</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  font-family:system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color:#e5e5e5;
}
#app{
  max-width:420px;
  margin:0 auto;
  height:100vh;
  background:#111;
  display:flex;
}

/* ===== SIDEBAR ===== */
#chats{
  width:110px;
  background:#0f0f0f;
  border-right:1px solid #222;
  overflow-y:auto;
}
.chatItem{
  padding:10px;
  text-align:center;
  cursor:pointer;
  border-bottom:1px solid #1a1a1a;
}
.avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  margin:0 auto 6px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  color:#000;
}
.chatName{
  font-size:11px;
  opacity:.8;
}

/* ===== CHAT ===== */
#chatView{
  flex:1;
  display:flex;
  flex-direction:column;
}
#header{
  padding:12px;
  background:#1a1a1a;
  border-bottom:1px solid #222;
  font-weight:600;
}
#messages{
  flex:1;
  padding:12px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.msg{
  max-width:80%;
  padding:10px 12px;
  border-radius:12px;
  font-size:14px;
  line-height:1.4;
}
.you{align-self:flex-end;background:#3a3a3a}
.other{align-self:flex-start;background:#1f1f2f}
.system{
  align-self:center;
  font-size:12px;
  opacity:.6;
}

/* typing */
#typing{
  padding:8px 12px;
  font-size:12px;
  opacity:.6;
  display:none;
}

/* choices */
#choices{
  padding:10px;
  border-top:1px solid #222;
}
.choice{
  width:100%;
  padding:10px;
  margin-top:6px;
  background:#1e1e1e;
  color:#fff;
  border:none;
  border-radius:8px;
}

/* effects */
@keyframes shake{
  0%{transform:translate(0,0)}
  25%{transform:translate(-2px,1px)}
  50%{transform:translate(2px,-1px)}
  75%{transform:translate(-1px,2px)}
  100%{transform:translate(0,0)}
}
.shake{animation:shake .4s infinite}
</style>
</head>
<body>

<div id="app">
  <div id="chats"></div>

  <div id="chatView">
    <div id="header">LINEA</div>
    <div id="messages"></div>
    <div id="typing">печатает…</div>
    <div id="choices"></div>
  </div>
</div>

<audio id="notif" src="click.mp3"></audio>

<script>
/* ===== STATE ===== */
let state={
  flags:{answeredUnknown:false},
  currentChat:null
};

const chatsData={
  unknown:{
    name:"Неизвестный",
    color:"#ff6b6b",
    messages:[
      {from:"system",text:"03:17"},
      {from:"other",text:"Ты снова здесь."}
    ]
  },
  anya:{
    name:"Аня",
    color:"#6bc5ff",
    messages:[
      {from:"system",text:"2 года назад"},
      {from:"other",text:"Если вдруг прочтёшь — не отвечай им."}
    ]
  },
  archive:{
    name:"Архив",
    color:"#aaa",
    messages:[
      {from:"system",text:"Служебные сообщения"},
      {from:"system",text:"Аккаунт восстановлен"}
    ]
  }
};

const chatsEl=document.getElementById("chats");
const header=document.getElementById("header");
const messages=document.getElementById("messages");
const choices=document.getElementById("choices");
const typing=document.getElementById("typing");
const notif=document.getElementById("notif");

/* ===== UI ===== */
function renderChats(){
  chatsEl.innerHTML="";
  Object.keys(chatsData).forEach(id=>{
    const c=chatsData[id];
    const div=document.createElement("div");
    div.className="chatItem";
    div.onclick=()=>openChat(id);

    const av=document.createElement("div");
    av.className="avatar";
    av.style.background=c.color;
    av.textContent=c.name[0];

    const name=document.createElement("div");
    name.className="chatName";
    name.textContent=c.name;

    div.append(av,name);
    chatsEl.appendChild(div);
  });
}

function openChat(id){
  state.currentChat=id;
  const chat=chatsData[id];
  header.textContent=chat.name;
  messages.innerHTML="";
  choices.innerHTML="";
  typing.style.display="none";

  chat.messages.forEach(m=>addMsg(m.text,m.from));
  messages.scrollTop=messages.scrollHeight;

  storyRouter(id);
}

function addMsg(text,from){
  const div=document.createElement("div");
  div.className="msg "+from;
  div.textContent=text;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
}

function showTyping(time=1000){
  typing.style.display="block";
  setTimeout(()=>typing.style.display="none",time);
}

function addChoice(text,action){
  const b=document.createElement("button");
  b.className="choice";
  b.textContent=text;
  b.onclick=()=>{
    addMsg(text,"you");
    choices.innerHTML="";
    action();
  };
  choices.appendChild(b);
}

/* ===== STORY LOGIC ===== */
function storyRouter(id){
  if(id==="unknown" && !state.flags.answeredUnknown){
    addChoice("Кто ты?",()=>{
      state.flags.answeredUnknown=true;
      showTyping(1200);
      setTimeout(()=>{
        addMsg("Ты уже задавал этот вопрос.","other");
        notif.play();
        chatsData.anya.messages.push(
          {from:"other",text:"Он написал тебе, да?"}
        );
        renderChats();
      },1200);
    });
    addChoice("Молчать",()=>{
      addMsg("…","you");
    });
  }

  if(id==="anya"){
    addChoice("Что ты имеешь в виду?",()=>{
      showTyping(1000);
      setTimeout(()=>{
        addMsg("LINEA не закрыли.","other");
        addMsg("Просто убрали тех, кто отвечал.","other");
      },1000);
    });
  }
}

/* ===== INIT ===== */
renderChats();
openChat("archive");
</script>
</body>
</html>
